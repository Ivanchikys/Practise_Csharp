@model IEnumerable<EveningMovies.Models.EveningMovieViewModel>
@{
    ViewData["Title"] = "Список фильмов на вечер";
}

<h1>@ViewData["Title"]</h1>

@if (ViewBag.PageMessage != null)
{
     <div class="alert alert-info">@ViewBag.PageMessage</div>
}
@if (TempData["SuccessMessage"] != null)
{
     <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

<p>
    <a asp-action="Add" asp-controller="EveningMovie" class="btn btn-primary">Добавить фильм</a>
</p>

@if (!Model.Any())
{
        <p>Пока не добавлено ни одного фильма на вечер. <a asp-action="Add">Будьте первым!</a></p>
}
else
{
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.First().Title)</th>
                    <th>@Html.DisplayNameFor(model => model.First().Genre)</th>
                    <th>@Html.DisplayNameFor(model => model.First().StartTime)</th>
                    <th>@Html.DisplayNameFor(model => model.First().RecommendedBy)</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var item in Model)
            {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.Title)</td>
                            <td>
                        @if (!string.IsNullOrWhiteSpace(item.Genre))
                        {
                            var genres = item.Genre.Split(new[] { ',', ';' }, StringSplitOptions.RemoveEmptyEntries);
                            foreach (var genre in genres)
                            {
                                var trimmedGenre = genre.Trim();
                                if (!string.IsNullOrEmpty(trimmedGenre))
                                {
                                                        <a asp-action="ByGenre" asp-controller="EveningMovie" asp-route-genre="@trimmedGenre">@trimmedGenre</a>
                                                        <span> </span>
                                }
                            }
                        }
                        else
                        {
                            <span>(Не указан)</span>
                        }
                            </td>
                            <td>@Html.DisplayFor(modelItem => item.StartTime, "{0:HH:mm}")</td>
                            <td> 
                                <a asp-action="ByRecommender" asp-controller="EveningMovie" asp-route-name="@item.RecommendedBy">
                            @Html.DisplayFor(modelItem => item.RecommendedBy)
                                </a>
                            </td>
                        </tr>
            }
            </tbody>
        </table>
}